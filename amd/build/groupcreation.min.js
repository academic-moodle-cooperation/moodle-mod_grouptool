define(["jquery","core/config","core/str","core/log"],function(a,b,c,d){var e=function(){this.SELECTORS={FIELDSETCONTAINSADVANCED:"fieldset.containsadvancedelements",DIVFITEMADVANCED:"div.fitem.advanced",DIVFCONTAINER:"div.fcontainer",MORELESSLINK:"fieldset.containsadvancedelements .moreless-toggler",MORELESSLINKONLY:".moreless-toggler",MODEINPUT:"input[name=mode]:checked"},this.CSS={SHOW:"show",MORELESSACTIONS:"moreless-actions",MORELESSTOGGLER:"moreless-toggler",SHOWLESS:"moreless-less"},this.fromtomode=-1};e.prototype.addTag=function(b){d.info("Add tag...","grouptool");var c=a("input[name=namingscheme]");b.preventDefault();var e=a(b.target),f=e.data("nametag"),g=c.val(),h=c[0].selectionStart;c.val(g.substring(0,h)+f+g.substring(h)),c.focus();var i=h+f.length;c[0].selectionStart=i,c[0].selectionEnd=i},e.prototype.modechange=function(b){d.info("Modechange!","grouptool");var e=a(b.target),f=e.closest(b.data.SELECTORS.FIELDSETCONTAINSADVANCED),g=a(b.data.SELECTORS.MODEINPUT).val();if(parseInt(g)===parseInt(b.data.fromtomode)&&!f.find(b.data.SELECTORS.DIVFITEMADVANCED).hasClass(b.data.CSS.SHOW)){d.info("Make advanced fields visible!","grouptool"),a(b.data.SELECTORS.DIVFITEMADVANCED).toggleClass(b.data.CSS.SHOW);var h=a(b.data.SELECTORS.MORELESSLINKONLY),i=a("input[name=mform_showmore_"+f.get("id")+"]");"0"===i.val()&&(i.val(1),c.get_string("showless","form").done(function(a){h.html(a)}).fail(function(a){d.error("Failed getting string showless from form!"+a,"grouptool")}),h.addClass(b.data.CSS.SHOWLESS))}};var f=new e;return f.initializer=function(b){this.fromtomode=b.fromtomode,d.info("Initialise grouptool group creation js...","grouptool");var c=a("[data-nametag]");c.on("click",null,this,this.addTag),c.css("cursor","pointer"),a('input[name="mode"]').on("change",null,this,this.modechange)},f});