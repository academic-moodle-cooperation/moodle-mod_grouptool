define(["jquery","core/config","core/str","core/log"],function(a,b,c,d){var e=function(){this.SELECTORS={FIELDSETCONTAINSADVANCED:"fieldset.containsadvancedelements",DIVFITEMADVANCED:"div.fitem.advanced",DIVFCONTAINER:"div.fcontainer",MORELESSLINK:"fieldset.containsadvancedelements .moreless-toggler",MORELESSLINKONLY:".moreless-toggler",MODEINPUT:"input[name=mode]:checked"},this.CSS={SHOW:"show",MORELESSACTIONS:"moreless-actions",MORELESSTOGGLER:"moreless-toggler",SHOWLESS:"moreless-less"},this.fromtomode=-1};e.prototype.add_tag=function(b){d.info("Add tag...","grouptool");var c=a("input[name=namingscheme]");b.preventDefault();for(var e=a(b.target).attr("class"),f=e.split(" "),g="",h=0;h<f.length;h++)"tag"!==f[h]&&(g="number"===f[h]?"#":"alpha"===f[h]?"@":"["+f[h]+"]");var i=c.val();c.val(i+g),c.attr("value",i+g),c.attr("defaultValue",i+g)},e.prototype.modechange=function(b){d.info("Modechange!","grouptool"),b.target=a(b.target);var e=b.target.closest(b.data.SELECTORS.FIELDSETCONTAINSADVANCED),f=a(b.data.SELECTORS.MODEINPUT).val();if(parseInt(f)===parseInt(b.data.fromtomode)&&!e.find(b.data.SELECTORS.DIVFITEMADVANCED).hasClass(b.data.CSS.SHOW)){d.info("Make advanced fields visible!","grouptool"),a(b.data.SELECTORS.DIVFITEMADVANCED).toggleClass(b.data.CSS.SHOW);var g=a(b.data.SELECTORS.MORELESSLINKONLY),h=a("input[name=mform_showmore_"+e.get("id")+"]");"0"===h.val()&&(h.val(1),c.get_string("showless","form").done(function(a){g.html(a)}).fail(function(a){d.error("Failed getting string showless from form!"+a,"grouptool")}),g.addClass(b.data.CSS.SHOWLESS))}};var f=new e;return f.initializer=function(b){this.fromtomode=b.fromtomode,d.info("Initialise grouptool group creation js...","grouptool"),a(".tag").on("click",null,this,this.add_tag),a(".tag").css("cursor","pointer"),a('input[name="mode"]').on("change",null,this,this.modechange)},f});