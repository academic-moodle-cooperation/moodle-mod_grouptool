{"version":3,"file":"grading.min.js","sources":["../src/grading.js"],"sourcesContent":["// This file is part of mod_grouptool for Moodle - http://moodle.org/\n//\n// It is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// It is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JS handling select box content in group grading tab\n *\n * @module   mod_grouptool/grading\n * @author    Philipp Hager\n * @copyright 2014 Academic Moodle Cooperation {@link http://www.academic-moodle-cooperation.org}\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_grouptool/grading\n */\ndefine(['jquery', 'core/config', 'core/str', 'core/log'], function($, config, str, log) {\n\n    /**\n     * @constructor\n     */\n    var Grading = function() {\n        this.contextid = 0;\n        this.lang = '';\n\n        this.SELECTORS = {\n            GROUPINGSELECT: 'select[name=grouping]',\n            GROUPSELECT: 'select[name=filter]'\n        };\n    };\n\n    /**\n     * Updates the groups according to selected groupings\n     *\n     * @param {Event} e Event object\n     */\n    Grading.prototype.updateGroups = function(e) {\n        var groupingid = 0;\n\n        log.info(\"Update groups!\", \"grouptool\");\n\n        groupingid = $(e.data.SELECTORS.GROUPINGSELECT).val();\n\n        if (groupingid < 0) {\n            groupingid = 0;\n        }\n\n        var contextid = e.data.contextid;\n\n        var cfg = {\n            method: 'get',\n            url: config.wwwroot + '/mod/grouptool/groupinggroups_ajax.php',\n            data: {\n                'groupingid': groupingid,\n                'lang': config.lang,\n                'contextid': contextid\n            },\n            dataType: 'json',\n            beforeSend: function() {\n                log.info(\"Request groups for grouping \" + groupingid, \"grouptool\");\n            },\n            success: function(data) {\n\n                if (!data.error) {\n                    var options = '';\n                    var oldsel = $(e.data.SELECTORS.GROUPSELECT).val();\n\n                    for (var i = 0; i < data.length; i++) {\n                        if ($(e.data.SELECTORS.GROUPSELECT).filter(' option[value=\"' + data[i].id + '\"]')\n                            && $(e.data.SELECTORS.GROUPSELECT).filter(' option[value=\"' + data[i].id + '\"]').get('selected')) {\n                            options += \"\\n<option value=\\\"\" + data[i].id + \"\\\" selected=\\\"selected\\\">\" + data[i].name + \"</option>\";\n                        } else {\n                            options += \"\\n<option value=\\\"\" + data[i].id + \"\\\">\" + data[i].name + \"</option>\";\n                        }\n                    }\n                    $(e.data.SELECTORS.GROUPSELECT).html(options);\n                    $(e.data.SELECTORS.GROUPSELECT).val(oldsel);\n                } else {\n                    log.error(data.error, \"grouptool\");\n                }\n            },\n            error: function(jqXHR, error) {\n                log.error(error, \"grouptool\");\n            }\n        };\n\n        $.ajax(cfg);\n    };\n\n    var instance = new Grading();\n\n    /**\n     * Initializer\n     *\n     * @param {object} params\n     */\n    instance.initializer = function(params) {\n        instance.contextid = params.contextid;\n        $(this.SELECTORS.GROUPINGSELECT).on('change', null, this, instance.updateGroups);\n\n        var form = $('#grading_form');\n        var selects = form.find('input[name=\"selected[]\"]');\n\n        form.on('click', '.checkboxcontroller a.select_all', function(e) {\n            e.stopPropagation();\n            e.preventDefault();\n\n            // Select all!\n            selects.prop('checked', true);\n        });\n        form.on('click', '.checkboxcontroller a.select_none', function(e) {\n            e.stopPropagation();\n            e.preventDefault();\n\n            // Deselect all!\n            selects.prop('checked', false);\n        });\n    };\n\n    return instance;\n});\n"],"names":["define","$","config","str","log","Grading","contextid","lang","SELECTORS","GROUPINGSELECT","GROUPSELECT","prototype","updateGroups","e","groupingid","info","data","val","cfg","method","url","wwwroot","dataType","beforeSend","success","error","options","oldsel","i","length","filter","id","get","name","html","jqXHR","ajax","instance","initializer","params","this","on","form","selects","find","stopPropagation","preventDefault","prop"],"mappings":";;;;;;;;AA2BAA,+BAAO,CAAC,SAAU,cAAe,WAAY,aAAa,SAASC,EAAGC,OAAQC,IAAKC,SAK3EC,QAAU,gBACLC,UAAY,OACZC,KAAO,QAEPC,UAAY,CACbC,eAAgB,wBAChBC,YAAa,wBASrBL,QAAQM,UAAUC,aAAe,SAASC,OAClCC,WAAa,EAEjBV,IAAIW,KAAK,iBAAkB,cAE3BD,WAAab,EAAEY,EAAEG,KAAKR,UAAUC,gBAAgBQ,OAE/B,IACbH,WAAa,OAGbR,UAAYO,EAAEG,KAAKV,UAEnBY,IAAM,CACNC,OAAQ,MACRC,IAAKlB,OAAOmB,QAAU,yCACtBL,KAAM,YACYF,gBACNZ,OAAOK,eACFD,WAEjBgB,SAAU,OACVC,WAAY,WACRnB,IAAIW,KAAK,+BAAiCD,WAAY,cAE1DU,QAAS,SAASR,SAETA,KAAKS,MAeNrB,IAAIqB,MAAMT,KAAKS,MAAO,iBAfT,SACTC,QAAU,GACVC,OAAS1B,EAAEY,EAAEG,KAAKR,UAAUE,aAAaO,MAEpCW,EAAI,EAAGA,EAAIZ,KAAKa,OAAQD,IACzB3B,EAAEY,EAAEG,KAAKR,UAAUE,aAAaoB,OAAO,kBAAoBd,KAAKY,GAAGG,GAAK,OACrE9B,EAAEY,EAAEG,KAAKR,UAAUE,aAAaoB,OAAO,kBAAoBd,KAAKY,GAAGG,GAAK,MAAMC,IAAI,YACrFN,SAAW,oBAAuBV,KAAKY,GAAGG,GAAK,yBAA8Bf,KAAKY,GAAGK,KAAO,YAE5FP,SAAW,oBAAuBV,KAAKY,GAAGG,GAAK,KAAQf,KAAKY,GAAGK,KAAO,YAG9EhC,EAAEY,EAAEG,KAAKR,UAAUE,aAAawB,KAAKR,SACrCzB,EAAEY,EAAEG,KAAKR,UAAUE,aAAaO,IAAIU,UAK5CF,MAAO,SAASU,MAAOV,OACnBrB,IAAIqB,MAAMA,MAAO,eAIzBxB,EAAEmC,KAAKlB,UAGPmB,SAAW,IAAIhC,eAOnBgC,SAASC,YAAc,SAASC,QAC5BF,SAAS/B,UAAYiC,OAAOjC,UAC5BL,EAAEuC,KAAKhC,UAAUC,gBAAgBgC,GAAG,SAAU,KAAMD,KAAMH,SAASzB,kBAE/D8B,KAAOzC,EAAE,iBACT0C,QAAUD,KAAKE,KAAK,4BAExBF,KAAKD,GAAG,QAAS,oCAAoC,SAAS5B,GAC1DA,EAAEgC,kBACFhC,EAAEiC,iBAGFH,QAAQI,KAAK,WAAW,MAE5BL,KAAKD,GAAG,QAAS,qCAAqC,SAAS5B,GAC3DA,EAAEgC,kBACFhC,EAAEiC,iBAGFH,QAAQI,KAAK,WAAW,OAIzBV"}