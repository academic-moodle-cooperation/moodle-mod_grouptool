{"version":3,"sources":["../src/grading.js"],"names":["define","$","config","str","log","Grading","contextid","lang","SELECTORS","GROUPINGSELECT","GROUPSELECT","prototype","updateGroups","e","groupingid","info","data","val","cfg","method","url","wwwroot","dataType","beforeSend","success","error","options","oldsel","i","length","filter","id","get","name","html","jqXHR","ajax","instance","initializer","params","on","form","selects","find","stopPropagation","preventDefault","prop"],"mappings":"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","sourcesContent":["// This file is part of mod_grouptool for Moodle - http://moodle.org/\n//\n// It is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// It is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JS handling select box content in group grading tab\n *\n * @module   mod_grouptool/grading\n * @author    Philipp Hager\n * @copyright 2014 Academic Moodle Cooperation {@link http://www.academic-moodle-cooperation.org}\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_grouptool/grading\n */\ndefine(['jquery', 'core/config', 'core/str', 'core/log'], function($, config, str, log) {\n\n    /**\n     * @constructor\n     */\n    var Grading = function() {\n        this.contextid = 0;\n        this.lang = '';\n\n        this.SELECTORS = {\n            GROUPINGSELECT: 'select[name=grouping]',\n            GROUPSELECT: 'select[name=filter]'\n        };\n    };\n\n    /**\n     * Updates the groups according to selected groupings\n     *\n     * @param {Event} e Event object\n     */\n    Grading.prototype.updateGroups = function(e) {\n        var groupingid = 0;\n\n        log.info(\"Update groups!\", \"grouptool\");\n\n        groupingid = $(e.data.SELECTORS.GROUPINGSELECT).val();\n\n        if (groupingid < 0) {\n            groupingid = 0;\n        }\n\n        var contextid = e.data.contextid;\n\n        var cfg = {\n            method: 'get',\n            url: config.wwwroot + '/mod/grouptool/groupinggroups_ajax.php',\n            data: {\n                'groupingid': groupingid,\n                'lang': config.lang,\n                'contextid': contextid\n            },\n            dataType: 'json',\n            beforeSend: function() {\n                log.info(\"Request groups for grouping \" + groupingid, \"grouptool\");\n            },\n            success: function(data) {\n\n                if (!data.error) {\n                    var options = '';\n                    var oldsel = $(e.data.SELECTORS.GROUPSELECT).val();\n\n                    for (var i = 0; i < data.length; i++) {\n                        if ($(e.data.SELECTORS.GROUPSELECT).filter(' option[value=\"' + data[i].id + '\"]')\n                            && $(e.data.SELECTORS.GROUPSELECT).filter(' option[value=\"' + data[i].id + '\"]').get('selected')) {\n                            options += \"\\n<option value=\\\"\" + data[i].id + \"\\\" selected=\\\"selected\\\">\" + data[i].name + \"</option>\";\n                        } else {\n                            options += \"\\n<option value=\\\"\" + data[i].id + \"\\\">\" + data[i].name + \"</option>\";\n                        }\n                    }\n                    $(e.data.SELECTORS.GROUPSELECT).html(options);\n                    $(e.data.SELECTORS.GROUPSELECT).val(oldsel);\n                } else {\n                    log.error(data.error, \"grouptool\");\n                }\n            },\n            error: function(jqXHR, error) {\n                log.error(error, \"grouptool\");\n            }\n        };\n\n        $.ajax(cfg);\n    };\n\n    var instance = new Grading();\n\n    /**\n     * Initializer\n     *\n     * @param {object} params\n     */\n    instance.initializer = function(params) {\n        instance.contextid = params.contextid;\n        $(this.SELECTORS.GROUPINGSELECT).on('change', null, this, instance.updateGroups);\n\n        var form = $('#grading_form');\n        var selects = form.find('input[name=\"selected[]\"]');\n\n        form.on('click', '.checkboxcontroller a.select_all', function(e) {\n            e.stopPropagation();\n            e.preventDefault();\n\n            // Select all!\n            selects.prop('checked', true);\n        });\n        form.on('click', '.checkboxcontroller a.select_none', function(e) {\n            e.stopPropagation();\n            e.preventDefault();\n\n            // Deselect all!\n            selects.prop('checked', false);\n        });\n    };\n\n    return instance;\n});\n"],"file":"grading.min.js"}