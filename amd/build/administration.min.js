define ("mod_grouptool/administration",["jquery","core/templates","core/ajax","core/str","core/url","core/notification","core/log"],function(a,b,c,d,f,g,h){var i=function(){this.cmid=0;this.filter=null;this.filterall=null;this.globalsize=3};i.prototype.renamegroup=function(d){h.info("Rename Group!","grouptool");d.preventDefault();d.stopPropagation();var e={},f=[],i=a(d.target).closest("[data-rename]"),j=i.closest("tr"),k=j.data("id"),l=i,m=l.prevAll("input[type=hidden]"),n=l.prevAll("span.text"),o="";l.fadeOut(600);m.fadeOut(600);n.fadeOut(600,function(){m.attr("type","text");m.fadeIn(600);m.focus();m.select()});m.on("keydown",null,d.data,function(d){if(13===d.which||27===d.which){d.preventDefault();d.stopPropagation()}if(13===d.which){f=c.call([{methodname:"mod_grouptool_rename_group",args:{cmid:d.data.cmid,groupid:k,name:m.val()},fail:g.exception}]);if(o){o.fadeOut(600);o.remove()}f[0].then(function(c){if(c.error){e={message:c.error};b.render("core/notification_error",e).then(function(b){o=a(b);o.hide();j.find(".grpname div").prepend(o);o.fadeIn(600);window.setTimeout(function(){o.fadeOut(600,function(){o.remove()})},60000);return this}).fail(g.exception)}else{e={message:c.message};b.render("core/notification_success",e).then(function(){n.html(m.val());m.fadeOut(600,function(){m.attr("value",m.val());m.attr("type","hidden");n.fadeIn(600);l.fadeIn(600)});m.off("keydown");return this}).fail(g.exception);h.info("AJAX Call to rename group "+k+" successfull\n"+status,"grouptool")}return this}).fail(g.exception)}else if(27===d.which){m.fadeOut(600,function(){n.hide();m.attr("type","hidden");m.val(n.html());m.attr("value",n.html());n.fadeIn(600);l.fadeIn(600)});if(o){o.fadeOut(600,function(){o.remove()})}m.unbind("key")}})};i.prototype.resizegroup=function(d){h.info("Resize Group!","grouptool");d.preventDefault();d.stopPropagation();var e=a(d.target).closest("[data-resize]"),f=e.closest("tr"),i=f.data("id"),j=d.data.instance.cmid,k=d.data.strings,l=d.data.globalsize,m=e,n=m.prevAll("input[type=hidden]"),o=m.prevAll("span.text"),p="",q="",r={},s=[];m.fadeOut(600);n.fadeOut(600);o.fadeOut(600,function(){n.attr("type","text");n.fadeIn(600);n.focus();n.select();var c={message:k.resizehelp};b.render("core/notification_info",c).then(function(b){q=a(b);q.hide();f.find(".size div").prepend(q);q.fadeIn(600);return this}).fail(g.exception)});n.on("keydown",null,null,function(d){if(13===d.which||27===d.which){d.preventDefault();d.stopPropagation()}if(13===d.which){s=c.call([{methodname:"mod_grouptool_resize_group",args:{cmid:parseInt(j),groupid:i,size:n.val()},fail:g.exception}]);if(p){p.fadeOut(600);p.remove()}if(q){q.fadeOut(600);q.remove()}s[0].then(function(c){if(c.error){r={message:c.error};b.render("core/notification_error",r).then(function(b){p=a(b);p.hide();f.find(".size div").prepend(p);p.fadeIn(600);window.setTimeout(function(){p.fadeOut(600,function(){p.remove()})},60000);return this}).fail(g.exception)}else{r={message:c.message};b.render("core/notification_success",r).then(function(b){p=a(b);p.hide();f.find(".size div").prepend(p);p.fadeIn(600);var c=n.val();if(""===c){o.html(l+"*")}else{o.html(c)}n.fadeOut(600,function(){n.attr("value",n.val());n.attr("type","hidden");o.fadeIn(600);m.fadeIn(600);n.off("keydown")});window.setTimeout(function(){p.fadeOut(600,function(){p.remove()})},5000);return this}).fail(g.exception)}h.info("AJAX Call to resize group "+i+" successfull\n"+status,"grouptool");return this}).fail(g.exception)}else if(27===d.which){n.fadeOut(600,function(){o.hide();n.attr("type","hidden");n.attr("value",o.html());n.val(o.html());o.fadeIn(600);m.fadeIn(600)});if(p){p.fadeOut(600,function(){p.remove()})}if(q){q.fadeOut(600,function(){p.remove()})}n.unbind("key")}})};i.prototype.togglegroup=function(i){i.preventDefault();i.stopPropagation();var e=[],j={},k=a(i.target).closest("[data-toggle]"),l=k.closest("tr"),m=l.data("id");h.info("TOGGLE GROUP "+m,"grouptool");var n=l.data("status");if(1===n||!0===n){h.info("DEACTIVATE GROUP "+m+"!","grouptool");e=c.call([{methodname:"mod_grouptool_deactivate_group",args:{cmid:i.data.cmid,groupid:m},fail:g.exception}]);e[0].then(function(c){if(c.error){h.info("AJAX Call to deactivate group "+m+" successfull but error occured:\n"+c.error+"\n"+n,"grouptool")}else{if("active"===i.data.filter){l.find("td div").slideUp(600).promise().done(function(){l.remove();if(!a("div.sortlist_container tr").length){d.get_strings([{key:"nogroupsactive",component:"mod_grouptool"},{key:"nogroupschoose",component:"mod_grouptool"}]).done(function(c){var d=f.relativeUrl("/mod/grouptool/view.php",{id:i.data.cmid,tab:"group_administration",filter:i.data.filterall}),e="<a href=\""+d+"\">"+c[2]+"</a>",h={message:c[0]+e},j=a("div.sortlist_container");j.fadeOut(600,function(){b.render("core/notification_info",h).then(function(a){j.html(a);j.fadeIn(600);return this}).fail(g.exception)})}).fail(g.exception)}}).fail(g.exception)}else{var e={id:i.data.cmid,tab:"administration"};j={status:!1,missing:!1,groupings:k.closest("tr").data("groupings"),id:m,checked:k.closest("tr").find("input[type=checkbox]").prop("checked"),name:k.closest("tr").data("name"),pageurl:f.relativeUrl("/mod/grouptool/view.php",e,!1),order:k.closest("tr").data("order"),usesize:!!i.data.usesize,size:k.closest("tr").data("size")};var o=b.render("mod_grouptool/sortlist_entry",j);l.toggleClass("slidup");l.find("td div").slideUp(600).promise().done(function(){o.then(function(b){var c=l.parents("table").find("tr[data-status=0], tr[data-status=false]").first(),d=l.parents("table").find("tr[data-status=1], tr[data-status=true]").last();if(c.length){l.detach();l.insertBefore(c)}else if(d.length){l.detach();l.insertAfter(d)}var e=a(b);e.addClass("slidup");e.find("td div").slideUp(0);l.replaceWith(e);e.find("[data-drag]").removeClass("js_invisible").css("cursor","pointer");e.toggleClass("slidup");e.find("td div").slideDown(600);l=e;return this}).fail(g.exception)}).fail(g.exception)}h.info("AJAX Call to deactivate group "+m+" successfull\n"+c.message+"\n"+n,"grouptool")}return this}).fail(g.exception)}else if(0===n||!1===n){h.info("ACTIVATE GROUP "+m+"!","grouptool");e=c.call([{methodname:"mod_grouptool_activate_group",args:{cmid:i.data.cmid,groupid:m},fail:g.exception}]);e[0].then(function(c){if(c.error){h.info("AJAX Call to activate group "+m+" successfull but error occured:\n"+c.error+"\n"+n,"grouptool")}else{if("inactive"===i.data.filter){l.find("td div").slideUp(600).promise().done(function(){l.remove();if(!a("div.sortlist_container tr").length){d.get_strings([{key:"nogroupsinactive",component:"mod_grouptool"},{key:"nogroupschoose",component:"mod_grouptool"}]).done(function(c){var d=f.relativeUrl("/mod/grouptool/view.php",{id:i.data.cmid,tab:"group_administration",filter:i.data.filterall}),e="<a href=\""+d+"\">"+c[2]+"</a>";j={message:c[0]+e};var h=a("div.sortlist_container");h.fadeOut(600,function(){b.render("core/notification_info",j).then(function(a){h.html(a);h.fadeIn(600);return this}).fail(g.exception)})}).fail(g.exception)}})}else{var e={id:i.data.cmid,tab:"administration"};j={status:!0,missing:!1,groupings:l.data("groupings"),id:m,checked:l.find("input[type=checkbox]").prop("checked"),name:l.data("name"),pageurl:f.relativeUrl("/mod/grouptool/view.php",e,!1),order:l.data("order"),usesize:!!i.data.usesize,size:l.data("size")};var o=b.render("mod_grouptool/sortlist_entry",j);l.toggleClass("slidup");k.closest("tr").find("td div").slideUp(600).promise().done(function(){o.then(function(b){var c=l.parents("table").find("tr[data-status=0], tr[data-status=false]").first(),d=l.parents("table").find("tr[data-status=1], tr[data-status=true]").last();if(d.length){l.detach();l.insertAfter(d)}else if(c.length){l.detach();l.insertBefore(c)}var e=a(b);e.addClass("slidup");e.find("td div").slideUp(0);l.replaceWith(e);e.find("[data-drag]").removeClass("js_invisible").css("cursor","pointer");e.toggleClass("slidup");e.find("td div").slideDown(600);l=e;return this}).fail(g.exception)}).fail(g.exception)}h.info("AJAX Call to activate group "+m+" successfull\n"+c.message,"grouptool")}return this}).fail(g.exception)}else{h.error("Group with id "+m+" must have either status 1 or 0!","grouptool")}};i.prototype.deletegroup=function(b){b.preventDefault();b.stopPropagation();if(a(b.target).closest("[data-delete]").hasClass("disabled")){return}var d=a(b.target).closest("[data-delete]"),e=d.closest("tr"),f=e.data("id"),i=b.data.strings;g.confirm(i.title,i.confirm,i.yes,i.no,function(){if(!f){h.info("No Group ID!","grouptool");return}h.info("DELETE GROUP "+f+"!","grouptool");var a=c.call([{methodname:"mod_grouptool_delete_group",args:{cmid:b.data.cmid,groupid:f},fail:g.exception}]);a[0].then(function(a){g.fetchNotifications();if(!a.error){e.find("td div").slideUp(600).promise().done(function(){e.remove()})}else{g.exception(a.error)}h.info("AJAX Call to delete group "+f+" successfull\n"+status,"grouptool");return this}).fail(g.exception)})};var j=new i;j.initializer=function(b,c,e,f,g){this.cmid=b;this.filter=c;this.filterall=e;this.globalsize=f;this.usesize=g;h.info("Initialize Grouptool group administration","grouptool");a(".path-mod-grouptool").on("click","tr[data-id] a[data-rename]",this,this.renamegroup);h.debug("Init edit size button","grouptool");d.get_strings([{key:"ajax_edit_size_help",component:"mod_grouptool"}]).done(function(b){var c={resizehelp:b[0]};h.debug("String successfully retrieved: "+b,"grouptool");var d={instance:j,strings:c,globalsize:j.globalsize};a(".path-mod-grouptool").on("click","tr[data-id] a[data-resize]",d,j.resizegroup)}).fail(function(a){h.error("Error while retrieving string: "+a,"grouptool")});d.get_strings([{key:"confirm_delete_title",component:"mod_grouptool"},{key:"confirm_delete",component:"mod_grouptool"},{key:"yes",component:"moodle"},{key:"no",component:"moodle"}]).done(function(b){h.info("Strings successfully retrieved: "+b,"grouptool");var c={title:b[0],confirm:b[1],yes:b[2],no:b[3]};a(".path-mod-grouptool .mod_grouptool_sortlist").on("click","tr[data-id] a[data-delete]",{cmid:j.cmid,strings:c},j.deletegroup)}).fail(function(a){h.error("Error while retrieving strings: "+a,"grouptool")});a(".path-mod-grouptool .mod_grouptool_sortlist").on("click","tr[data-id] a[data-toggle]",this,this.togglegroup)};return j});
//# sourceMappingURL=administration.min.js.map
