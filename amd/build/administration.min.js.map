{"version":3,"file":"administration.min.js","sources":["../src/administration.js"],"sourcesContent":["// This file is part of mod_grouptool for Moodle - http://moodle.org/\n//\n// It is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// It is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript for group administration (rename, resize, toggle and deletion)\n *\n * @module   mod_grouptool/administration\n * @author    Philipp Hager\n * @copyright 2014 Academic Moodle Cooperation {@link http://www.academic-moodle-cooperation.org}\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n /**\n  * @module mod_grouptool/administration\n  */\ndefine(['jquery', 'core/templates', 'core/ajax', 'core/str', 'core/url', 'core/notification', 'core/log'], function($, templates,\n        ajax, str, murl, notif, log) {\n\n    /**\n     * @constructor\n     * @alias module:mod_grouptool/administration\n     */\n    var Administration = function() {\n        this.cmid = 0;\n        this.filter = null;\n        this.filterall = null;\n        this.globalsize = 3;\n    };\n\n    /**\n     * Rename 1 moodle group via AJAX request.\n     *\n     * @param {Event} e Event object\n     */\n    Administration.prototype.renamegroup = function(e) {\n        log.info('Rename Group!', 'grouptool');\n        e.preventDefault();\n        e.stopPropagation();\n\n        var context = {};\n        var requests = [];\n\n        // Get group id!\n        var target = $(e.target).closest('[data-rename]');\n        var node = target.closest('tr');\n        var grpid = node.data('id');\n\n        var button = target;\n        var field = button.prevAll('input[type=hidden]');\n        var text = button.prevAll('span.text');\n        var infoNode = '';\n        button.fadeOut(600);\n        field.fadeOut(600);\n        text.fadeOut(600, function() {\n            field.attr('type', 'text');\n            field.fadeIn(600);\n            field.focus();\n            field.select();\n        });\n        field.on('keydown', null, e.data, function(e) {\n            if (e.which === 13 || e.which === 27) {\n                e.preventDefault();\n                e.stopPropagation();\n            }\n\n            if (e.which === 13) { // Enter!\n                requests = ajax.call([{\n                    methodname: 'mod_grouptool_rename_group',\n                    args: {cmid: e.data.cmid, groupid: grpid, name: field.val()},\n                    fail: notif.exception\n                }]);\n                if (infoNode) {\n                    infoNode.fadeOut(600);\n                    infoNode.remove();\n                }\n                requests[0].then(function(result) {\n                    if (result.error) {\n                        context = {\n                            'message': result.error\n                        };\n                        templates.render('core/notification_error', context).then(function(html) {\n                            infoNode = $(html);\n                            infoNode.hide();\n                            node.find('.grpname div').prepend(infoNode);\n                            infoNode.fadeIn(600);\n                            // Remove after 60 seconds automatically!\n                            window.setTimeout(function() {\n                                infoNode.fadeOut(600, function() {\n                                    infoNode.remove();\n                                });\n                            }, 60 * 1000);\n\n                            return this;\n                        }).fail(notif.exception);\n                    } else {\n                        context = {\n                            'message': result.message\n                        };\n                        templates.render('core/notification_success', context).then(function() {\n\n                            text.html(field.val());\n                            field.fadeOut(600, function() {\n                                field.attr('value', field.val());\n                                field.attr('type', 'hidden');\n                                text.fadeIn(600);\n                                button.fadeIn(600);\n                            });\n                            field.off('keydown');\n\n                            return this;\n                        }).fail(notif.exception);\n\n                        log.info(\"AJAX Call to rename group \" + grpid + \" successfull\\n\" + status, \"grouptool\");\n                    }\n\n                    return this;\n                }).fail(notif.exception);\n\n            } else if (e.which === 27) { // Escape!\n                field.fadeOut(600, function() {\n                    text.hide();\n                    field.attr('type', 'hidden');\n                    field.val(text.html());\n                    field.attr('value', text.html());\n                    text.fadeIn(600);\n                    button.fadeIn(600);\n                });\n                if (infoNode) {\n                    infoNode.fadeOut(600, function() {\n                        infoNode.remove();\n                    });\n                }\n                field.unbind('key');\n            }\n        });\n    };\n\n    /**\n     * Change maximum group size of 1 moodle group via AJAX request.\n     *\n     * @param {Event} e Event object\n     */\n    Administration.prototype.resizegroup = function(e) {\n        log.info('Resize Group!', 'grouptool');\n        e.preventDefault();\n        e.stopPropagation();\n\n        // Get group id!\n        var target = $(e.target).closest('[data-resize]');\n        var node = target.closest('tr');\n        var grpid = node.data('id');\n\n        var cmid = e.data.instance.cmid;\n\n        var strings = e.data.strings;\n        var globalsize = e.data.globalsize;\n\n        var button = target;\n        var field = button.prevAll('input[type=hidden]');\n        var text = button.prevAll('span.text');\n        var infoNode = '';\n        var helpNode = '';\n\n        var context = {};\n        var requests = [];\n\n        button.fadeOut(600);\n        field.fadeOut(600);\n        text.fadeOut(600, function() {\n            field.attr('type', 'text');\n            field.fadeIn(600);\n            field.focus();\n            field.select();\n            var context = {\n                'message': strings.resizehelp\n            };\n            templates.render('core/notification_info', context).then(function(html) {\n                helpNode = $(html);\n                helpNode.hide();\n                node.find('.size div').prepend(helpNode);\n                helpNode.fadeIn(600);\n\n                return this;\n            }).fail(notif.exception);\n        });\n        field.on('keydown', null, null, function(e) {\n            if (e.which === 13 || e.which === 27) {\n                e.preventDefault();\n                e.stopPropagation();\n            }\n\n            if (e.which === 13) { // Enter!\n                requests = ajax.call([{\n                    methodname: 'mod_grouptool_resize_group',\n                    args: {cmid: parseInt(cmid), groupid: grpid, size: field.val()},\n                    fail: notif.exception\n                }]);\n                if (infoNode) {\n                    infoNode.fadeOut(600);\n                    infoNode.remove();\n                }\n                if (helpNode) {\n                    helpNode.fadeOut(600);\n                    helpNode.remove();\n                }\n                requests[0].then(function(result) {\n                    if (result.error) {\n                        context = {\n                            'message': result.error\n                        };\n                        templates.render('core/notification_error', context).then(function(html) {\n                            infoNode = $(html);\n                            infoNode.hide();\n                            node.find('.size div').prepend(infoNode);\n                            infoNode.fadeIn(600);\n                            // Remove after 60 seconds automatically!\n                            window.setTimeout(function() {\n                                infoNode.fadeOut(600, function() {\n                                    infoNode.remove();\n                                });\n                            }, 60 * 1000);\n\n                            return this;\n                        }).fail(notif.exception);\n                    } else {\n                        context = {\n                            'message': result.message\n                        };\n                        templates.render('core/notification_success', context).then(function(html) {\n                            infoNode = $(html);\n                            infoNode.hide();\n                            node.find('.size div').prepend(infoNode);\n                            infoNode.fadeIn(600);\n                            var newvalue = field.val();\n                            if (newvalue === '') {\n                                text.html(globalsize + '*');\n                            } else {\n                                text.html(newvalue);\n                            }\n                            field.fadeOut(600, function() {\n                                field.attr('value', field.val());\n                                field.attr('type', 'hidden');\n                                text.fadeIn(600);\n                                button.fadeIn(600);\n                                field.off('keydown');\n                            });\n                            window.setTimeout(function() {\n                                infoNode.fadeOut(600, function() {\n                                    infoNode.remove();\n                                });\n                            }, 5 * 1000);\n\n                            return this;\n                        }).fail(notif.exception);\n                    }\n                    log.info(\"AJAX Call to resize group \" + grpid + \" successfull\\n\" + status, \"grouptool\");\n\n                    return this;\n                }).fail(notif.exception);\n\n            } else if (e.which === 27) { // Escape!\n                field.fadeOut(600, function() {\n                    text.hide();\n                    field.attr('type', 'hidden');\n                    field.attr('value', text.html());\n                    field.val(text.html());\n                    text.fadeIn(600);\n                    button.fadeIn(600);\n                });\n                if (infoNode) {\n                    infoNode.fadeOut(600, function() {\n                        infoNode.remove();\n                    });\n                }\n                if (helpNode) {\n                    helpNode.fadeOut(600, function() {\n                        infoNode.remove();\n                    });\n                }\n                field.unbind('key');\n            }\n        });\n    };\n\n    /**\n     * Toggle 1 group (active/inactive) and change symbol or remove the HTML node respectively.\n     *\n     * @param {Event} e Event object\n     */\n    Administration.prototype.togglegroup = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        var requests = [];\n        var context = {};\n\n        var target = $(e.target).closest(\"[data-toggle]\");\n\n        var node = target.closest('tr');\n\n        var grpid = node.data('id');\n\n        log.info('TOGGLE GROUP ' + grpid, \"grouptool\");\n\n        var status = node.data('status');\n\n        if (status === 1 || status === true) {\n            // Set inactive (via AJAX Request)!\n            log.info('DEACTIVATE GROUP ' + grpid + '!', \"grouptool\");\n\n            requests = ajax.call([{\n                methodname: 'mod_grouptool_deactivate_group',\n                args: {cmid: e.data.cmid, groupid: grpid},\n                fail: notif.exception\n            }]);\n            requests[0].then(function(result) {\n                if (result.error) {\n                    var text = \"AJAX Call to deactivate group \" + grpid + \" successfull but error occured:\\n\";\n                    log.info(text + result.error + \"\\n\" + status, \"grouptool\");\n                } else {\n                    if (e.data.filter === 'active') {\n                        node.find('td div').slideUp(600).promise().done(function() {\n                            node.remove();\n                            if (!$('div.sortlist_container tr').length) {\n                                /* TODO: instead we could just switch to filter all via JS/AJAX i.e. render mustache template\n                                 * for all groups sortlist! */\n                                var stringstofetch = [{'key': 'nogroupsactive', 'component': 'mod_grouptool'},\n                                                      {'key': 'nogroupschoose', 'component': 'mod_grouptool'}];\n                                str.get_strings(stringstofetch).done(function(s) {\n                                    var url = murl.relativeUrl('/mod/grouptool/view.php', {\n                                        'id': e.data.cmid,\n                                        'tab': 'group_administration',\n                                        'filter': e.data.filterall\n                                    });\n                                    var link = \"<a href=\\\"\" + url + \"\\\">\" + s[2] + \"</a>\";\n                                    var context = {\n                                        'message': s[0] + link\n                                    };\n                                    var sortlistcontainer = $('div.sortlist_container');\n                                    sortlistcontainer.fadeOut(600, function() {\n                                        templates.render('core/notification_info', context).then(function(html) {\n                                            sortlistcontainer.html(html);\n                                            sortlistcontainer.fadeIn(600);\n\n                                            return this;\n                                        }).fail(notif.exception);\n                                    });\n                                }).fail(notif.exception);\n                            }\n                        }).fail(notif.exception);\n                    } else {\n                        // Render the element again and display it!\n                        var viewparams = {\n                            'id': e.data.cmid,\n                            'tab': 'administration'\n                        };\n                        context = {\n                            \"status\": false,\n                            \"missing\": false,\n                            \"groupings\": target.closest('tr').data('groupings'),\n                            \"id\": grpid,\n                            \"checked\": target.closest('tr').find('input[type=checkbox]').prop('checked'),\n                            \"name\": target.closest('tr').data('name'),\n                            \"pageurl\": murl.relativeUrl(\"/mod/grouptool/view.php\", viewparams, false),\n                            \"order\": target.closest('tr').data('order'),\n                            \"usesize\": !!e.data.usesize,\n                            \"size\": target.closest('tr').data('size')\n                        };\n                        var templatepromise = templates.render('mod_grouptool/sortlist_entry', context);\n                        // This will call the function to load and render our template.\n                        node.toggleClass('slidup');\n                        node.find('td div').slideUp(600).promise().done(function() {\n                            templatepromise.then(function(html) {\n                                var firstinactive = node.parents('table').find('tr[data-status=0], tr[data-status=false]').first();\n                                var lastactive = node.parents('table').find('tr[data-status=1], tr[data-status=true]').last();\n                                if (firstinactive.length) {\n                                    node.detach();\n                                    node.insertBefore(firstinactive);\n                                } else if (lastactive.length) {\n                                    node.detach();\n                                    node.insertAfter(lastactive);\n                                }\n                                var newnode = $(html);\n                                newnode.addClass('slidup');\n                                newnode.find('td div').slideUp(0);\n                                node.replaceWith(newnode);\n                                newnode.find('[data-drag]').removeClass('js_invisible').css('cursor', 'pointer');\n                                newnode.toggleClass('slidup');\n                                newnode.find('td div').slideDown(600);\n                                node = newnode;\n\n                                return this;\n                            }).fail(notif.exception);\n                        }).fail(notif.exception);\n                    }\n                    log.info(\"AJAX Call to deactivate group \" + grpid + \" successfull\\n\" + result.message + \"\\n\" + status,\n                        \"grouptool\");\n                }\n\n                return this;\n            }).fail(notif.exception);\n        } else if (status === 0 || status === false) {\n            // Set active (via AJAX Request)!\n            log.info('ACTIVATE GROUP ' + grpid + '!', \"grouptool\");\n\n            requests = ajax.call([{\n                methodname: 'mod_grouptool_activate_group',\n                args: {cmid: e.data.cmid, groupid: grpid},\n                fail: notif.exception\n            }]);\n            requests[0].then(function(result) {\n                if (result.error) {\n                    var text = \"AJAX Call to activate group \" + grpid + \" successfull but error occured:\\n\";\n                    log.info(text + result.error + \"\\n\" + status, \"grouptool\");\n                } else {\n                    if (e.data.filter === 'inactive') {\n                        // If showing only inactive remove from list!\n                        node.find('td div').slideUp(600).promise().done(function() {\n                            node.remove();\n                            if (!$('div.sortlist_container tr').length) {\n                                /* TODO: instead we could just switch to filter all via JS/AJAX i.e. render mustache template\n                                 * for all groups sortlist! */\n                                var stringstofetch = [\n                                    {'key': 'nogroupsinactive', 'component': 'mod_grouptool'},\n                                    {'key': 'nogroupschoose', 'component': 'mod_grouptool'}\n                                ];\n                                str.get_strings(stringstofetch).done(function(s) {\n                                    var url = murl.relativeUrl('/mod/grouptool/view.php', {\n                                        'id': e.data.cmid,\n                                        'tab': 'group_administration',\n                                        'filter': e.data.filterall\n                                    });\n                                    var link = \"<a href=\\\"\" + url + \"\\\">\" + s[2] + \"</a>\";\n                                    context = {\n                                        'message': s[0] + link\n                                    };\n                                    var sortlistcontainer = $('div.sortlist_container');\n                                    sortlistcontainer.fadeOut(600, function() {\n                                        templates.render('core/notification_info', context).then(function(html) {\n                                            sortlistcontainer.html(html);\n                                            sortlistcontainer.fadeIn(600);\n\n                                            return this;\n                                        }).fail(notif.exception);\n                                    });\n                                }).fail(notif.exception);\n                            }\n                        });\n                    } else {\n                        // Replace sortlist entry!\n                        var viewparams = {\n                            'id': e.data.cmid,\n                            'tab': 'administration'\n                        };\n                        // This will call the function to load and render our template.\n                        context = {\n                            \"status\": true,\n                            \"missing\": false,\n                            \"groupings\": node.data('groupings'),\n                            \"id\": grpid,\n                            \"checked\": node.find('input[type=checkbox]').prop('checked'),\n                            \"name\": node.data('name'),\n                            \"pageurl\": murl.relativeUrl(\"/mod/grouptool/view.php\", viewparams, false),\n                            \"order\": node.data('order'),\n                            \"usesize\": !!e.data.usesize,\n                            \"size\": node.data('size')\n                        };\n                        var templatepromise = templates.render('mod_grouptool/sortlist_entry', context);\n                        node.toggleClass('slidup');\n                        target.closest('tr').find('td div').slideUp(600).promise().done(function() {\n                            templatepromise.then(function(html) {\n                                var firstinactive = node.parents('table').find('tr[data-status=0], tr[data-status=false]').first();\n                                var lastactive = node.parents('table').find('tr[data-status=1], tr[data-status=true]').last();\n                                if (lastactive.length) {\n                                    node.detach();\n                                    node.insertAfter(lastactive);\n                                } else if (firstinactive.length) {\n                                    node.detach();\n                                    node.insertBefore(firstinactive);\n                                }\n                                var newnode = $(html);\n                                newnode.addClass('slidup');\n                                newnode.find('td div').slideUp(0);\n                                node.replaceWith(newnode);\n                                newnode.find('[data-drag]').removeClass('js_invisible').css('cursor', 'pointer');\n                                newnode.toggleClass('slidup');\n                                newnode.find('td div').slideDown(600);\n                                node = newnode;\n\n                                return this;\n                            }).fail(notif.exception);\n                        }).fail(notif.exception);\n                    }\n                    log.info(\"AJAX Call to activate group \" + grpid + \" successfull\\n\" + result.message, \"grouptool\");\n                }\n\n                return this;\n            }).fail(notif.exception);\n        } else {\n            // Error!\n            log.error('Group with id ' + grpid + ' must have either status 1 or 0!', \"grouptool\");\n        }\n    };\n\n    /**\n     * Delete one moodle group via AJAX request.\n     *\n     * @param {Event} e Event object\n     */\n    Administration.prototype.deletegroup = function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        if ($(e.target).closest('[data-delete]').hasClass('disabled')) {\n            return;\n        }\n\n        // Get group id!\n        var target = $(e.target).closest('[data-delete]');\n\n        var node = target.closest('tr');\n\n        var grpid = node.data('id');\n\n        var strings = e.data.strings;\n\n        notif.confirm(strings.title, strings.confirm, strings.yes, strings.no, function() {\n            if (!grpid) {\n                log.info('No Group ID!', 'grouptool');\n                return;\n            }\n\n            log.info('DELETE GROUP ' + grpid + '!', \"grouptool\");\n\n            var requests = ajax.call([{\n                methodname: 'mod_grouptool_delete_group',\n                args: {cmid: e.data.cmid, groupid: grpid},\n                fail: notif.exception\n            }]);\n            requests[0].then(function(result) {\n                // So now the group's maybe recreated by grouptool instances set to do so, show notifications!\n                notif.fetchNotifications();\n                if (!result.error) {\n                    // Success, remove the corresponding table entry...\n                    node.find('td div').slideUp(600).promise().done(function() {\n                        node.remove();\n                    });\n                } else {\n                    notif.exception(result.error);\n                }\n                log.info(\"AJAX Call to delete group \" + grpid + \" successfull\\n\" + status, \"grouptool\");\n\n                return this;\n            }).fail(notif.exception);\n        });\n    };\n\n    var instance = new Administration();\n\n    /**\n     * Initialize the JS (save params and attach event handler).\n     *\n     * @param {int} cmid\n     * @param {string} filter\n     * @param {int} filterall\n     * @param {int} globalsize\n     * @param {int} usesize\n     */\n    instance.initializer = function(cmid, filter, filterall, globalsize, usesize) {\n\n        this.cmid = cmid;\n        this.filter = filter;\n        this.filterall = filterall;\n        this.globalsize = globalsize;\n        this.usesize = usesize;\n\n        log.info('Initialize Grouptool group administration', \"grouptool\");\n        $('.path-mod-grouptool').on('click', 'tr[data-id] a[data-rename]', this, this.renamegroup);\n        log.debug(\"Init edit size button\", \"grouptool\");\n        str.get_strings([{key: 'ajax_edit_size_help', component: 'mod_grouptool'}]).done(function(s) {\n            var strings = {resizehelp: s[0]};\n            log.debug(\"String successfully retrieved: \" + s, \"grouptool\");\n            var resizedata = {instance: instance, strings: strings, globalsize: instance.globalsize};\n            $('.path-mod-grouptool').on('click', 'tr[data-id] a[data-resize]', resizedata, instance.resizegroup);\n        }).fail(function(ex) {\n            log.error(\"Error while retrieving string: \" + ex, \"grouptool\");\n        });\n        var stringstofetch = [\n            {key: 'confirm_delete_title', component: 'mod_grouptool'},\n            {key: 'confirm_delete', component: 'mod_grouptool'},\n            {key: 'yes', component: 'moodle'},\n            {key: 'no', component: 'moodle'}\n        ];\n        str.get_strings(stringstofetch).done(function(s) {\n            log.info(\"Strings successfully retrieved: \" + s, \"grouptool\");\n            var strings = {title: s[0], confirm: s[1], yes: s[2], no: s[3]};\n            $('.path-mod-grouptool .mod_grouptool_sortlist').on('click', 'tr[data-id] a[data-delete]',\n                    {cmid: instance.cmid, strings: strings}, instance.deletegroup);\n        }).fail(function(ex) {\n            log.error(\"Error while retrieving strings: \" + ex, \"grouptool\");\n        });\n        $('.path-mod-grouptool .mod_grouptool_sortlist').on('click', 'tr[data-id] a[data-toggle]', this, this.togglegroup);\n    };\n\n    return instance;\n});\n"],"names":["define","$","templates","ajax","str","murl","notif","log","Administration","cmid","filter","filterall","globalsize","prototype","renamegroup","e","info","preventDefault","stopPropagation","context","requests","target","closest","node","grpid","data","button","field","prevAll","text","infoNode","fadeOut","attr","fadeIn","focus","select","on","which","call","methodname","args","groupid","name","val","fail","exception","remove","then","result","error","message","render","html","hide","find","prepend","window","setTimeout","this","off","status","unbind","resizegroup","instance","strings","helpNode","resizehelp","parseInt","size","newvalue","togglegroup","slideUp","promise","done","length","get_strings","key","component","s","link","relativeUrl","id","tab","sortlistcontainer","viewparams","missing","checked","prop","usesize","templatepromise","toggleClass","firstinactive","parents","first","lastactive","last","detach","insertBefore","insertAfter","newnode","addClass","replaceWith","removeClass","css","slideDown","groupings","order","deletegroup","hasClass","confirm","title","yes","no","fetchNotifications","initializer","debug","resizedata","ex"],"mappings":"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"}