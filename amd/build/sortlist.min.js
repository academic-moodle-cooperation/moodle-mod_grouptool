define(["jquery","jqueryui","core/config","core/str","core/url","core/log"],function(a,b,c,d,e,f){var g=function(){this.contextid=0,this.lang="en"};g.prototype.update_checkboxes=function(b,c){var d="";a('select[name="classes[]"] option:selected').each(function(b,c){""!==d&&(d+=", "),d+=".class"+a(c).val()});var e=a(d);switch(b.preventDefault(),c){case"select":e.prop("checked",!0);break;case"deselect":e.prop("checked",!1);break;case"toggle":e.each(function(b,c){a(c).prop("checked")?a(c).prop("checked",!1):a(c).prop("checked",!0)});break;default:f.info("Undefined new checkbox state!","grouptool")}},g.prototype.dragStartHandler=function(a,b){var c=b.helper;c.find(".movedownbutton").css("visibility","visible"),c.find(".moveupbutton").css("visibility","visible")},g.prototype.dragEndHandler=function(){var b={};if(a("table.drag_list tr.draggable_item").find(".movedownbutton, .movelupbutton").css("visibility","visible"),a("table.drag_list tr.draggable_item").first().find(".movelupbutton").css("visibility","hidden"),a("table.drag_list tr.draggable_item").last().find(".moveldownbutton").css("visibility","hidden"),a("table.drag_list tr.draggable_item td input.sort_order").each(function(c,d){d=a(d),d.attr("value",c+1),b[d.attr("name")]=d.val()}),""!==b){var d=h.contextid,e="",g={method:"POST",url:c.wwwroot+"/mod/grouptool/editgroup_ajax.php",data:a.extend({action:"reorder",sesskey:M.cfg.sesskey,contextid:d},b),headers:{"X-Transaction":"POST reorder groups"},dataType:"json",beforeSend:function(){""!==e&&e.fadeOut(600).delay(600).remove(),f.info("Start AJAX Call to reorder groups","grouptool")},complete:function(){f.info("AJAX Call to reorder groups completed","grouptool")},success:function(b,c){var d="";b.error?(d=a('<div class="infonode alert-error" style="display:none">'+b.error+"</div>"),a("table.drag_list").before(d),e=a("div.infonode"),e.fadeIn(600),window.setTimeout(function(){e.fadeOut(600).delay(600).remove()},6e4),f.info("AJAX Call to reorder groups successfull\nError ocured:"+b.error+"\n"+c,"grouptool")):(d=a('<div class="infonode alert-success" style="display:none">'+b.message+"</div>"),a("table.drag_list").before(d),e=a("div.infonode"),e.fadeIn(600),window.setTimeout(function(){e.fadeOut(600).delay(600).remove()},5e3),f.info("AJAX Call to reorder groups successfull\n"+b.message+"\n"+c,"grouptool"))},error:function(a,b,c){f.error("AJAX Call to reorder groups failure\nStatus: "+b+"\nError:"+c,"grouptool")},end:function(){f.info("AJAX Call to reorder groups ended","grouptool")}};a.ajax(g)}},g.prototype.moveDown=function(b){b.target=a(b.target);var d=b.target.closest(".draggable_item").find(".sort_order").val(),e=b.target.closest(".draggable_item").next(".draggable_item").find(".sort_order").val();b.preventDefault(),b.stopPropagation();var g=b.data.contextid,h=b.target.closest(".draggable_item").next(".draggable_item").find('input[name="selected[]"]'),i={method:"POST",url:M.cfg.wwwroot+"/mod/grouptool/editgroup_ajax.php",data:{action:"swap",sesskey:c.sesskey,contextid:g,groupA:b.target.closest(".draggable_item").find('input[name="selected[]"]').val(),groupB:h.val()},headers:{"X-Transaction":"POST reorder groups"},beforeSend:function(){f.info("Start AJAX Call to reorder groups","grouptool")},complete:function(){f.info("AJAX Call to reorder groups completed","grouptool")},success:function(a,b){a.error?f.info("AJAX Call to reorder groups successfull\nError occured:"+a.error+"\n"+b,"grouptool"):f.info("AJAX Call to reorder groups successfull\n"+a.message+"\n"+b,"grouptool")},failure:function(a,b,c){f.error("AJAX Call to reorder groups failure\nStatus: "+b+"\nError:"+c,"grouptool")},end:function(){f.info("AJAX Call to reorder groups ended","grouptool")}};a.ajax(i);var j=b.target.closest(".draggable_item"),k=b.target.closest(".draggable_item").next(".draggable_item");k.after(j.clone(!0)),j.replaceWith(k),b.target.closest(".draggable_item").find("input.sort_order").val(e),b.target.closest(".draggable_item").prev(".draggable_item").find("input.sort_order").val(d)},g.prototype.moveUp=function(b){b.target=a(b.target);var d=b.target.closest(".draggable_item").find(".sort_order").val(),e=b.target.closest(".draggable_item").prev(".draggable_item").find(".sort_order").val();b.preventDefault(),b.stopPropagation();var g=b.data.contextid,h=b.target.closest(".draggable_item").prev(".draggable_item").find('input[name="selected[]"]'),i={method:"POST",url:M.cfg.wwwroot+"/mod/grouptool/editgroup_ajax.php",data:{action:"swap",sesskey:c.sesskey,contextid:g,groupA:b.target.closest(".draggable_item").find('input[name="selected[]"]').val(),groupB:h.val()},headers:{"X-Transaction":"POST reorder groups"},beforeSend:function(){f.info("Start AJAX Call to reorder groups","grouptool")},complete:function(){f.info("AJAX Call to reorder groups completed","grouptool")},success:function(a,b){a.error?f.error("AJAX Call to reorder groups successfull\nError ocured:"+a.error+"\n"+b,"grouptool"):f.info("AJAX Call to reorder groups successfull\n"+a.message+"\n"+b,"grouptool")},failure:function(a,b,c){f.error("AJAX Call to reorder groups failure\nStatus: "+b+"\nErrortext:"+c,"grouptool")},end:function(){f.info("AJAX Call to reorder groups ended","grouptool")}};a.ajax(i),b.target.closest(".draggable_item").find("input.sort_order").val(e),b.target.closest(".draggable_item").prev(".draggable_item").find("input.sort_order").val(d);var j=b.target.closest(".draggable_item"),k=b.target.closest(".draggable_item").prev(".draggable_item");j.before(k.clone(!0)),k.replaceWith(j)};var h=new g;return h.initializer=function(b){h.contextid=b.contextid,h.lang=b.lang,f.info("Initialize Grouptool sortlist","grouptool"),a(".path-mod-grouptool .drag_list tbody").sortable({containment:".drag_list tbody",cursor:"move",delay:150,handle:".drag_image",items:" .draggable_item",opacity:.5,helper:"clone",axis:"y",start:h.dragStartHandler,stop:h.dragEndHandler}),a(".path-mod-grouptool .drag_list .draggable_item .drag_image").removeClass("js_invisible"),a(".path-mod-grouptool .buttons .movedownbutton").on("click",null,this,h.moveDown),a(".path-mod-grouptool .buttons .moveupbutton").on("click",null,this,h.moveUp);var c=a('button[name="do_class_action"]');c?c.on("click",function(b){var c="";a('input[name="class_action"]').each(function(d,e){a(e).prop("checked")===!0&&(c=a(e).val(),f.info("Update checkboxes '"+c+"'!"),h.update_checkboxes(b,c))})}):f.info("No sortlist controller found!","grouptool"),a(".simple_select_all").on("click",function(b){f.info("Bind select-all handler!","grouptool"),b.preventDefault(),b.stopPropagation(),a(".class0").prop("checked",!0)}),a(".simple_select_none").on("click",function(b){f.info("Bind deselect-all handler!","grouptool"),b.preventDefault(),b.stopPropagation(),a(".class0").prop("checked",!1)})},h});