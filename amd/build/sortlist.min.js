define(["jquery","jqueryui","core/ajax","core/config","core/templates","core/str","core/url","core/log","core/notification"],function(a,b,c,d,e,f,g,h,i){var j=function(){this.cmid=0};j.prototype.update_checkboxes=function(b,c){var d="";a('select[name="classes[]"] option:selected').each(function(b,c){""!==d&&(d+=", "),d+=".class"+a(c).val()});var e=a(d);switch(b.preventDefault(),c){case"select":e.prop("checked",!0);break;case"deselect":e.prop("checked",!1);break;case"toggle":e.each(function(b,c){a(c).prop("checked")?a(c).prop("checked",!1):a(c).prop("checked",!0)});break;default:h.info("Undefined new checkbox state!","grouptool")}},j.prototype.dragStartHandler=function(a,b){var c=b.helper;c.find("a[data-movedown], a[data-moveup]").css("visibility","visible")},j.prototype.dragEndHandler=function(b){var d=[],f=a(".mod_grouptool_sortlist_body .mod_grouptool_sortlist_entry");if(f.find("a[data-movedown], a[data-moveup]").css("visibility","visible"),f.first().find("a[data-moveup]").css("visibility","hidden"),f.last().find("a[data-movedown]").css("visibility","hidden"),f.each(function(b){a(this).attr("order",b+1),a(this).find('input[name="order['+a(this).data("id")+']"]').val(b+1),d.push({groupid:a(this).data("id"),order:b+1})}),""!==d){var g=c.call([{methodname:"mod_grouptool_reorder_groups",args:{cmid:b.data.cmid,order:d},fail:i.exception}]);g[0].then(function(b){var c={message:"",extraclasses:"infonode"},d="core/notification_success",f=5e3;b.error?(d="core/notification_error",c.message=b.error,f=6e4,h.info("AJAX Call to reorder groups successfull\nError ocured:"+b.error+"\n"+status,"grouptool")):(c.message=b.message,h.info("AJAX Call to reorder groups successfull\n"+b.message+"\n"+status,"grouptool")),e.render(d,c).then(function(b){var c=a(b);c.hide(0),a("table.drag_list").before(c),c.slideDown(600,function(){window.setTimeout(function(){c.slideUp(600,function(){c.remove()})},f)})}).fail(i.exception)})}},j.prototype.moveDown=function(b){b.target=a(b.target);var d=b.target.closest(".mod_grouptool_sortlist_entry"),e=b.target.closest(".mod_grouptool_sortlist_entry").next(".mod_grouptool_sortlist_entry"),f=d.data("order"),g=e.data("order");b.preventDefault(),b.stopPropagation();var j=c.call([{methodname:"mod_grouptool_swap_groups",args:{cmid:b.data.cmid,a:d.data("id"),b:e.data("id")},fail:i.exception}]);j[0].then(function(a){a.error?i.exception(a.error):(e.after(d.clone(!0)),d.replaceWith(e),d.data("order",g),d.find('input[name="order['+d.data("id")+']"]').val(g),e.data("order",f),e.find('input[name="order['+e.data("id")+']"]').val(f),h.info(a.message))})},j.prototype.moveUp=function(b){b.target=a(b.target);var d=b.target.closest(".mod_grouptool_sortlist_entry"),e=b.target.closest(".mod_grouptool_sortlist_entry").prev(".mod_grouptool_sortlist_entry"),f=d.data("order"),g=e.data("order");b.preventDefault(),b.stopPropagation();var j=c.call([{methodname:"mod_grouptool_swap_groups",args:{cmid:b.data.cmid,a:d.data("id"),b:e.data("id")},fail:i.exception}]);j[0].then(function(a){a.error?i.exception(a.error):(e.before(d.clone(!0)),d.replaceWith(e),d.data("order",g),d.find('input[name="order['+d.data("id")+']"]').val(g),e.data("order",f),e.find('input[name="order['+e.data("id")+']"]').val(f),h.info(a.message))})};var k=new j;return k.initializer=function(b){k.cmid=b,h.info("Initialize Grouptool sortlist","grouptool"),a(".path-mod-grouptool .mod_grouptool_sortlist .mod_grouptool_sortlist_body").sortable({containment:".mod_grouptool_sortlist .mod_grouptool_sortlist_body",cursor:"move",delay:150,handle:"[data-drag]",items:" .mod_grouptool_sortlist_entry",opacity:.5,helper:"clone",axis:"y",start:k.dragStartHandler,stop:function(a,b){a.data=k,k.dragEndHandler(a,b)}});var c=a(".path-mod-grouptool .mod_grouptool_sortlist tr[data-id] [data-drag]");a(".path-mod-grouptool .mod_grouptool_sortlist tr .js_invisible").removeClass("js_invisible"),c.removeClass("js_invisible"),c.css("cursor","pointer");var d=a(".path-mod-grouptool .mod_grouptool_sortlist");d.on("click","tr[data-id] a[data-movedown]",this,k.moveDown),d.on("click","tr[data-id] a[data-moveup]",this,k.moveUp);var e=a('button[name="do_class_action"]');e?e.on("click",function(b){var c="";a('input[name="class_action"]').each(function(d,e){a(e).prop("checked")===!0&&(c=a(e).val(),h.info("Update checkboxes '"+c+"'!"),k.update_checkboxes(b,c))})}):h.info("No sortlist controller found!","grouptool"),a(".simple_select_all").on("click",function(b){h.info("Bind select-all handler!","grouptool"),b.preventDefault(),b.stopPropagation(),a(".class0").prop("checked",!0)}),a(".simple_select_none").on("click",function(b){h.info("Bind deselect-all handler!","grouptool"),b.preventDefault(),b.stopPropagation(),a(".class0").prop("checked",!1)})},k});