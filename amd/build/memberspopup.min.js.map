{"version":3,"sources":["../src/memberspopup.js"],"names":["define","$","ModalFactory","templates","url","str","log","instance","Memberspopup","showidnumber","courseid","initializer","config","info","modal","modalpromise","create","type","types","MODAL","body","get_string","done","s","on","e","stopPropagation","preventDefault","element","target","statushelp","parents","data","absregs","ex","gtregs","mregs","queued","name","context","profileurl","relativeUrl","promise","render","source","setTitle","setBody","show","fail","message","error"],"mappings":"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","sourcesContent":["// This file is part of mod_grouptool for Moodle - http://moodle.org/\n//\n// It is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// It is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript handling pop-over displaying group members\n *\n * @package   mod_grouptool\n * @author    Philipp Hager\n * @copyright 2014 Academic Moodle Cooperation {@link http://www.academic-moodle-cooperation.org}\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n /**\n  * @module mod_grouptool/memberspopup\n  */\ndefine(['jquery', 'core/modal_factory', 'core/templates', 'core/url', 'core/str', 'core/log'], function($, ModalFactory, templates,\n                                                                                                        url, str, log) {\n\n    /**\n     * @constructor\n     * @alias module:mod_grouptool/memberspopup\n     */\n    var Memberspopup = function() {\n        this.showidnumber = false;\n        this.courseid = '';\n    };\n\n    var instance = new Memberspopup();\n\n    /**\n     * Initializes the JS module\n     * @param {object} config\n     */\n    instance.initializer = function(config) {\n\n        instance.showidnumber = config.showidnumber;\n        instance.courseid = config.courseid;\n\n        log.info('Initialize groupmembers JS!', 'mod_grouptool');\n\n        if (!instance.modal) {\n            instance.modalpromise = ModalFactory.create({\n                type: ModalFactory.types.MODAL,\n                body: '...'\n            });\n        }\n\n        str.get_string('groupmembers').done(function(s) {\n            log.info('Done loading strings...', 'mod_grouptool');\n            instance.modalpromise.done(function(modal) {\n                log.info('Done preparing modal...', 'mod_grouptool');\n                instance.modal = modal;\n                $('#registration_form').on('click', 'span.memberstooltip > a', null, function(e) {\n                    e.stopPropagation();\n                    e.preventDefault();\n                    var element = $(e.target);\n\n                    var statushelp = element.parents('form').data('statushelp');\n\n                    var absregs;\n                    try {\n                        absregs = element.data('absregs');\n                    } catch (ex) {\n                        absregs = [];\n                    }\n\n                    var gtregs;\n                    try {\n                        gtregs = element.data('gtregs');\n                    } catch (ex) {\n                        gtregs = [];\n                    }\n\n                    var mregs;\n                    try {\n                        mregs = element.data('mregs');\n                    } catch (ex) {\n                        mregs = [];\n                    }\n\n                    var queued;\n                    try {\n                        queued = element.data('queued');\n                    } catch (ex) {\n                        queued = [];\n                    }\n\n                    var name;\n                    try {\n                        name = s + ': ' + element.data('name');\n                    } catch (ex) {\n                        name = s;\n                    }\n\n                    var context = {\n                        courseid: instance.courseid,\n                        showidnumber: instance.showidnumber,\n                        profileurl: url.relativeUrl(\"/user/view.php?course=\" + instance.courseid + \"&id=\"),\n                        statushelp: statushelp,\n                        absregs: absregs,\n                        gtregs: gtregs,\n                        mregs: mregs,\n                        queued: queued\n                    };\n\n                    // This will call the function to load and render our template.\n                    var promise = templates.render('mod_grouptool/groupmembers', context);\n\n                    // How we deal with promise objects is by adding callbacks.\n                    promise.done(function(source) {\n                        // Here eventually I have my compiled template, and any javascript that it generated.\n                        instance.modal.setTitle(name);\n                        instance.modal.setBody(source);\n                        instance.modal.show();\n                    }).fail(function(ex) {\n                        // Deal with this exception (I recommend core/notify exception function for this).\n                        instance.modal.setBody(ex.message);\n                        instance.modal.show();\n                    });\n                });\n            });\n        }).fail(function(ex) {\n            log.error(\"Error getting strings: \" + ex, \"mod_grouptool\");\n        });\n    };\n\n    return instance;\n});\n"],"file":"memberspopup.min.js"}