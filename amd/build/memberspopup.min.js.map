{"version":3,"file":"memberspopup.min.js","sources":["../src/memberspopup.js"],"sourcesContent":["// This file is part of mod_grouptool for Moodle - http://moodle.org/\n//\n// It is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// It is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript handling pop-over displaying group members\n *\n * @module   mod_grouptool/memberspopup\n * @author    Philipp Hager\n * @copyright 2014 Academic Moodle Cooperation {@link http://www.academic-moodle-cooperation.org}\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n /**\n  * @module mod_grouptool/memberspopup\n  */\ndefine(['jquery', 'core/modal_factory', 'core/templates', 'core/url', 'core/str', 'core/log'], function($, ModalFactory, templates,\n                                                                                                        url, str, log) {\n\n    /**\n     * @constructor\n     * @alias module:mod_grouptool/memberspopup\n     */\n    var Memberspopup = function() {\n        this.showidnumber = false;\n        this.courseid = '';\n    };\n\n    var instance = new Memberspopup();\n\n    /**\n     * Initializes the JS module\n     * @param {object} config\n     */\n    instance.initializer = function(config) {\n\n        instance.showidnumber = config.showidnumber;\n        instance.courseid = config.courseid;\n\n        log.info('Initialize groupmembers JS!', 'mod_grouptool');\n\n        if (!instance.modal) {\n            instance.modalpromise = ModalFactory.create({\n                type: ModalFactory.types.MODAL,\n                body: '...'\n            });\n        }\n\n        str.get_string('groupmembers').done(function(s) {\n            log.info('Done loading strings...', 'mod_grouptool');\n            instance.modalpromise.done(function(modal) {\n                log.info('Done preparing modal...', 'mod_grouptool');\n                instance.modal = modal;\n                $('#registration_form').on('click', 'span.memberstooltip > a', null, function(e) {\n                    e.stopPropagation();\n                    e.preventDefault();\n                    var element = $(e.target);\n\n                    var statushelp = element.parents('form').data('statushelp');\n\n                    var absregs;\n                    try {\n                        absregs = element.data('absregs');\n                    } catch (ex) {\n                        absregs = [];\n                    }\n\n                    var gtregs;\n                    try {\n                        gtregs = element.data('gtregs');\n                    } catch (ex) {\n                        gtregs = [];\n                    }\n\n                    var mregs;\n                    try {\n                        mregs = element.data('mregs');\n                    } catch (ex) {\n                        mregs = [];\n                    }\n\n                    var queued;\n                    try {\n                        queued = element.data('queued');\n                    } catch (ex) {\n                        queued = [];\n                    }\n\n                    var name;\n                    try {\n                        name = s + ': ' + element.data('name');\n                    } catch (ex) {\n                        name = s;\n                    }\n\n                    var context = {\n                        courseid: instance.courseid,\n                        showidnumber: instance.showidnumber,\n                        profileurl: url.relativeUrl(\"/user/view.php?course=\" + instance.courseid + \"&id=\"),\n                        statushelp: statushelp,\n                        absregs: absregs,\n                        gtregs: gtregs,\n                        mregs: mregs,\n                        queued: queued\n                    };\n\n                    // This will call the function to load and render our template.\n                    var promise = templates.render('mod_grouptool/groupmembers', context);\n\n                    // How we deal with promise objects is by adding callbacks.\n                    promise.done(function(source) {\n                        // Here eventually I have my compiled template, and any javascript that it generated.\n                        instance.modal.setTitle(name);\n                        instance.modal.setBody(source);\n                        instance.modal.show();\n                    }).fail(function(ex) {\n                        // Deal with this exception (I recommend core/notify exception function for this).\n                        instance.modal.setBody(ex.message);\n                        instance.modal.show();\n                    });\n                });\n            });\n        }).fail(function(ex) {\n            log.error(\"Error getting strings: \" + ex, \"mod_grouptool\");\n        });\n    };\n\n    return instance;\n});\n"],"names":["define","$","ModalFactory","templates","url","str","log","instance","showidnumber","courseid","initializer","config","info","modal","modalpromise","create","type","types","MODAL","body","get_string","done","s","on","e","stopPropagation","preventDefault","absregs","gtregs","mregs","queued","name","element","target","statushelp","parents","data","ex","context","profileurl","relativeUrl","render","source","setTitle","setBody","show","fail","message","error"],"mappings":";;;;;;;;AA0BAA,oCAAO,CAAC,SAAU,qBAAsB,iBAAkB,WAAY,WAAY,aAAa,SAASC,EAAGC,aAAcC,UACjBC,IAAKC,IAAKC,SAW1GC,SAAW,IALI,gBACVC,cAAe,OACfC,SAAW,WASpBF,SAASG,YAAc,SAASC,QAE5BJ,SAASC,aAAeG,OAAOH,aAC/BD,SAASE,SAAWE,OAAOF,SAE3BH,IAAIM,KAAK,8BAA+B,iBAEnCL,SAASM,QACVN,SAASO,aAAeZ,aAAaa,OAAO,CACxCC,KAAMd,aAAae,MAAMC,MACzBC,KAAM,SAIdd,IAAIe,WAAW,gBAAgBC,MAAK,SAASC,GACzChB,IAAIM,KAAK,0BAA2B,iBACpCL,SAASO,aAAaO,MAAK,SAASR,OAChCP,IAAIM,KAAK,0BAA2B,iBACpCL,SAASM,MAAQA,MACjBZ,EAAE,sBAAsBsB,GAAG,QAAS,0BAA2B,MAAM,SAASC,GAC1EA,EAAEC,kBACFD,EAAEE,qBAKEC,QAOAC,OAOAC,MAOAC,OAOAC,KAhCAC,QAAU/B,EAAEuB,EAAES,QAEdC,WAAaF,QAAQG,QAAQ,QAAQC,KAAK,kBAI1CT,QAAUK,QAAQI,KAAK,WACzB,MAAOC,IACLV,QAAU,OAKVC,OAASI,QAAQI,KAAK,UACxB,MAAOC,IACLT,OAAS,OAKTC,MAAQG,QAAQI,KAAK,SACvB,MAAOC,IACLR,MAAQ,OAKRC,OAASE,QAAQI,KAAK,UACxB,MAAOC,IACLP,OAAS,OAKTC,KAAOT,EAAI,KAAOU,QAAQI,KAAK,QACjC,MAAOC,IACLN,KAAOT,MAGPgB,QAAU,CACV7B,SAAUF,SAASE,SACnBD,aAAcD,SAASC,aACvB+B,WAAYnC,IAAIoC,YAAY,yBAA2BjC,SAASE,SAAW,QAC3EyB,WAAYA,WACZP,QAASA,QACTC,OAAQA,OACRC,MAAOA,MACPC,OAAQA,QAIE3B,UAAUsC,OAAO,6BAA8BH,SAGrDjB,MAAK,SAASqB,QAElBnC,SAASM,MAAM8B,SAASZ,MACxBxB,SAASM,MAAM+B,QAAQF,QACvBnC,SAASM,MAAMgC,UAChBC,MAAK,SAAST,IAEb9B,SAASM,MAAM+B,QAAQP,GAAGU,SAC1BxC,SAASM,MAAMgC,mBAI5BC,MAAK,SAAST,IACb/B,IAAI0C,MAAM,0BAA4BX,GAAI,qBAI3C9B"}